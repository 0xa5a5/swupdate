<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Suricatta daemon mode &mdash; Embedded Software Update Documentation 2017.01 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2017.01',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Embedded Software Update Documentation 2017.01 documentation" href="index.html" />
    <link rel="next" title="SWUpdate: syntax and tags with the default parser" href="sw-description.html" />
    <link rel="prev" title="SWUpdate: software update for embedded system" href="swupdate.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="sw-description.html" title="SWUpdate: syntax and tags with the default parser"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="swupdate.html" title="SWUpdate: software update for embedded system"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Embedded Software Update Documentation 2017.01 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="suricatta-daemon-mode">
<h1>Suricatta daemon mode<a class="headerlink" href="#suricatta-daemon-mode" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Suricatta is &#8211; like mongoose &#8211; a daemon mode of SWUpdate, hence the
name suricatta (engl. meerkat) as it belongs to the mongoose family.</p>
<p>Suricatta regularly polls a remote server for updates, downloads, and
installs them. Thereafter, it reboots the system and reports the update
status to the server, based on an update state variable currently stored
in U-Boot&#8217;s environment ensuring persistent storage across reboots. Some
U-Boot script logics or U-Boot&#8217;s <code class="docutils literal"><span class="pre">bootcount</span></code> feature may be utilized
to alter this update state variable, e.g., by setting it to reflect
failure in case booting the newly flashed root file system has failed
and a switchback had to be performed.</p>
<p>Suricatta is designed to be extensible in terms of the servers supported
as described in Section <a class="reference internal" href="#supporting-different-servers">Supporting different Servers</a>. Currently,
support for the <a class="reference external" href="https://projects.eclipse.org/projects/iot.hawkbit">hawkBit</a> server is implemented via the <a class="reference external" href="http://sp.apps.bosch-iot-cloud.com/documentation/developerguide/apispecifications/directdeviceintegrationapi.html">hawkBit Direct
Device Integration API</a>.</p>
</div>
<div class="section" id="running-suricatta">
<h2>Running suricatta<a class="headerlink" href="#running-suricatta" title="Permalink to this headline">¶</a></h2>
<p>After having configured and compiled SWUpdate with enabled suricatta
support,</p>
<div class="code highlight-python"><div class="highlight"><pre>./swupdate --help
</pre></div>
</div>
<p>lists the mandatory and optional arguments to be provided to suricatta
when using hawkBit as server. As an example,</p>
<div class="code bash highlight-python"><div class="highlight"><pre>./swupdate -l 5 -u &#39;-t default -u http://10.0.0.2:8080 -i 25&#39;
</pre></div>
</div>
<p>runs SWUpdate in suricatta daemon mode with log-level <code class="docutils literal"><span class="pre">TRACE</span></code>, polling
a hawkBit instance at <code class="docutils literal"><span class="pre">http://10.0.0.2:8080</span></code> with tenant <code class="docutils literal"><span class="pre">default</span></code>
and device ID <code class="docutils literal"><span class="pre">25</span></code>.</p>
<p>Note that on startup when having installed an update, suricatta
tries to report the update status to its upstream server, e.g.,
hawkBit, prior to entering the main loop awaiting further updates.
If this initial report fails, e.g., because of a not (yet) configured
network or a currently unavailable hawkBit server, swupdate may exit
with an according error code. This behavior allows to, for example,
try several upstream servers sequentially.
If suricatta should keep retrying until the update status is reported
to its upstream server irrespective of the error conditions, this has
to be realized externally in terms of restarting swupdate on exit.</p>
<p>After an update has been performed, an agent listening on the progress
interface may execute post-update actions, e.g., a reboot, on receiving
<code class="docutils literal"><span class="pre">DONE</span></code>.
Additionally, a post-update command specified in the configuration file or
given by the <code class="docutils literal"><span class="pre">-p</span></code> command line option can be executed.</p>
<p>Note that currently, at least a restart of SWUpdate has to be performed
as post-update action since only then suricatta tries to report the
update status to its upstream server.
Otherwise, on the next polling interval elapsed, the very same update is
announced by hawkBit as pending and is installed again if no update
status storage, i.e., <code class="docutils literal"><span class="pre">CONFIG_SURICATTA_STATE_CHOICE_NONE</span></code>, is selected.
If an update status storage, e.g., <code class="docutils literal"><span class="pre">CONFIG_SURICATTA_STATE_CHOICE_UBOOT</span></code>,
is selected, succinct update actions announced by hawkBit are skipped until
a restart of SWUpdate.</p>
</div>
<div class="section" id="supporting-different-servers">
<h2>Supporting different Servers<a class="headerlink" href="#supporting-different-servers" title="Permalink to this headline">¶</a></h2>
<p>Support for servers other than hawkBit can be realized by implementing
the &#8220;interfaces&#8221; described in <code class="docutils literal"><span class="pre">include/suricatta/channel.h</span></code> and
<code class="docutils literal"><span class="pre">include/suricatta/server.h</span></code>. The former abstracts a particular
connection to the server, e.g., HTTP-based in case of hawkBit, while
the latter implements the logics to poll and install updates.
See <code class="docutils literal"><span class="pre">suricatta/channel_hawkbit.{c,h}</span></code> and
<code class="docutils literal"><span class="pre">suricatta/server_hawkbit.{c,h}</span></code> for an example implementation
targeted towards hawkBit.</p>
<p><code class="docutils literal"><span class="pre">include/suricatta/channel.h</span></code> describes the functionality a channel
has to implement:</p>
<div class="code c highlight-python"><div class="highlight"><pre>channel_op_res_t channel_open(void *cfg);
channel_op_res_t channel_close(void);
channel_op_res_t channel_put(void* data);
channel_op_res_t channel_get(void* data);
channel_op_res_t channel_get_file(void* data);
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">include/suricatta/server.h</span></code> describes the functionality a server has
to implement:</p>
<div class="code c highlight-python"><div class="highlight"><pre>server_op_res_t server_start(int argc, char* argv[]);
server_op_res_t server_stop(void);
server_op_res_t server_has_pending_action(void);
server_op_res_t server_install_update(void);
unsigned int    server_get_polling_interval(void);
</pre></div>
</div>
<p>The types <code class="docutils literal"><span class="pre">channel_op_res_t</span></code> and <code class="docutils literal"><span class="pre">server_op_res_t</span></code> are defined in
<code class="docutils literal"><span class="pre">include/suricatta/suricatta.h</span></code> and represent the valid function
return codes for a channel&#8217;s and a server&#8217;s implementation,
respectively.</p>
<p>In addition to implementing the particular channel and server, the
<code class="docutils literal"><span class="pre">suricatta/Config.in</span></code> file has to be adapted to include a new option
so that the new implementation becomes selectable in SWUpdate&#8217;s
configuration. In the simplest case, adding an option like the following
one for hawkBit into the <code class="docutils literal"><span class="pre">menu</span> <span class="pre">&quot;Server&quot;</span></code> section is sufficient.</p>
<div class="highlight-python"><div class="highlight"><pre>config SURICATTA_HAWKBIT
    bool &quot;hawkBit support&quot;
    depends on HAVE_LIBCURL
    depends on HAVE_JSON_C
    default y
    help
    Support for hawkBit server.

    https://projects.eclipse.org/projects/iot.hawkbit
</pre></div>
</div>
<p>Note that the various server options and hence implementations should be
selectable in a mutually exclusive manner, i.e., at most one should be
active. Hence, include according <code class="docutils literal"><span class="pre">depends</span> <span class="pre">on</span> <span class="pre">!&lt;SERVER_OPTION&gt;</span></code> lines
into the configuration to specify this mutual exclusion of server
implementations. Support for multiple channels and servers
simultaneously is left for future work as outlined in suricatta&#8217;s
road-map.</p>
<p>Having included the new server implementation into the configuration,
edit <code class="docutils literal"><span class="pre">suricatta/Makefile</span></code> to specify the implementation&#8217;s linkage into
the SWUpdate binary, e.g., for the hawkBit example implementation, the
following lines add <code class="docutils literal"><span class="pre">channel_hawkbit.o</span></code> and <code class="docutils literal"><span class="pre">server_hawkbit.o</span></code> to
the resulting SWUpdate binary if <code class="docutils literal"><span class="pre">SURICATTA_HAWKBIT</span></code> was selected
while configuring SWUpdate.</p>
<div class="highlight-python"><div class="highlight"><pre>ifneq ($(CONFIG_SURICATTA_HAWKBIT),)
lib-$(CONFIG_SURICATTA) += channel_hawkbit.o server_hawkbit.o
endif
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Suricatta daemon mode</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#running-suricatta">Running suricatta</a></li>
<li><a class="reference internal" href="#supporting-different-servers">Supporting different Servers</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="swupdate.html"
                        title="previous chapter">SWUpdate: software update for embedded system</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="sw-description.html"
                        title="next chapter">SWUpdate: syntax and tags with the default parser</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/suricatta.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="sw-description.html" title="SWUpdate: syntax and tags with the default parser"
             >next</a> |</li>
        <li class="right" >
          <a href="swupdate.html" title="SWUpdate: software update for embedded system"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Embedded Software Update Documentation 2017.01 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2013-2017, Stefano Babic.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
  </body>
</html>