<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>swupdate: API for external programs &mdash; Embedded Software Update Documentation 2014.07 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2014.07',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Embedded Software Update Documentation 2014.07 documentation" href="index.html" />
    <link rel="next" title="Help and support" href="help_and_support.html" />
    <link rel="prev" title="Handlers" href="handlers.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="help_and_support.html" title="Help and support"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="handlers.html" title="Handlers"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Embedded Software Update Documentation 2014.07 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="swupdate-api-for-external-programs">
<h1>swupdate: API for external programs<a class="headerlink" href="#swupdate-api-for-external-programs" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>swupdate contains an integrated webserver to allow remote updating.
However, which protocols are involved during an update is project
specific and differs significantly. Some projects can decide
to use FTP to load an image from an external server, or using
even a proprietary protocol.
The integrated webserver uses this interface.</p>
<p>swupdate has a simple interface to let external programs
to communicate with the installer. Clients can start an upgrade
and stream an image to the installer, querying then for the status
and the final result. The API is at the moment very simple, but it can
easy be extended in the future if new use cases will arise.</p>
<div class="section" id="api-description">
<h3>API Description<a class="headerlink" href="#api-description" title="Permalink to this headline">¶</a></h3>
<p>The communication runs via UDS (Unix Domain Socket). The socket is created
at the startup by swupdate in /tmp/sockinstdata.</p>
<p>The exchanged packets are described in network_ipc.h</p>
<div class="highlight-python"><div class="highlight"><pre>typedef struct {
        int magic;
        int type;
        msgdata data;
} ipc_message;
</pre></div>
</div>
<p>Where the fields have the meaning:</p>
<ul class="simple">
<li>magic : a magic number as simple proof of the packet</li>
<li>type : one of REQ_INSTALL, ACK, NACK, GET_STATUS</li>
<li>msgdata : a buffer used by the client to send the image
or by swupdate to report back notifications and status.</li>
</ul>
<p>The client sends a REQ_INSTALL packet and waits for an answer.
swupdate sends back ACK or NACK, if for example an update is already in progress.</p>
<p>After the ACK, the client sends the whole image as a stream. swupdate
expectes that all bytes after the ACK are part of the image to be installed.
swupdate recognizes the size of the image from the CPIO header.
Any error lets swupdate to leave the update state, and further packets
will be ignored until a new REQ_INSTALL will be received.</p>
<img alt="_images/API.png" src="_images/API.png" />
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">swupdate: API for external programs</a><ul>
<li><a class="reference internal" href="#overview">Overview</a><ul>
<li><a class="reference internal" href="#api-description">API Description</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="handlers.html"
                        title="previous chapter">Handlers</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="help_and_support.html"
                        title="next chapter">Help and support</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/swupdate-ipc.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="help_and_support.html" title="Help and support"
             >next</a> |</li>
        <li class="right" >
          <a href="handlers.html" title="Handlers"
             >previous</a> |</li>
        <li><a href="index.html">Embedded Software Update Documentation 2014.07 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013-2014, Stefano Babic.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>